{% load static %}

<div class="admin-topbar">
  <!-- Mobile Menu Button -->
  <button class="mobile-menu-btn d-lg-none" id="mobileMenuBtn">
    <i class="bi bi-list"></i>
  </button>

  <!-- Welcome Message -->
  <div class="topbar-welcome">
    <h1>Welcome Back, {% if request.user.first_name %}{{ request.user.first_name }}{% else %}{{ request.user.username }}{% endif %}</h1>
  </div>

  <!-- Topbar Actions -->
  <div class="topbar-actions">
    <!-- Search Box -->
    <div class="search-box d-none d-md-flex">
      <i class="bi bi-search"></i>
      <input type="text" placeholder="Search" id="topbarSearch">
    </div>

    <!-- Notifications -->
    <div class="notification-btn" id="notificationBtn">
      <i class="bi bi-bell"></i>
      {% if pending_places > 0 %}
        <span class="notification-badge">{{ pending_places }}</span>
      {% endif %}
    </div>

    <!-- User Menu -->
    <div class="user-menu" id="userMenuToggle">
      {% if request.user.profile_picture %}
        <img src="{{ request.user.profile_picture.url }}" alt="{{ request.user.username }}" class="user-avatar">
      {% else %}
        <div class="user-avatar-placeholder">
          <i class="bi bi-person-circle"></i>
        </div>
      {% endif %}
      <span class="user-name d-none d-md-inline">{{ request.user.username }}</span>
      <i class="bi bi-chevron-down"></i>
    </div>

    <!-- User Dropdown Menu -->
    <div class="user-dropdown" id="userDropdown">
      <div class="dropdown-header">
        <strong>{{ request.user.username }}</strong>
        <small class="text-muted">{{ request.user.email }}</small>
      </div>
      <div class="dropdown-divider"></div>
      <a href="{% url 'core:landing' %}" class="dropdown-item">
        <i class="bi bi-house-door me-2"></i>Ir para o Site
      </a>
      <a href="/admin/" class="dropdown-item" target="_blank">
        <i class="bi bi-gear me-2"></i>Django Admin
      </a>
      <div class="dropdown-divider"></div>
      <a href="{% url 'accounts:logout' %}" class="dropdown-item text-danger">
        <i class="bi bi-box-arrow-left me-2"></i>Sair
      </a>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Mobile menu button
    const mobileMenuBtn = document.getElementById('mobileMenuBtn');
    const sidebar = document.getElementById('adminSidebar');
    const overlay = document.getElementById('sidebarOverlay');

    if (mobileMenuBtn) {
      mobileMenuBtn.addEventListener('click', function() {
        sidebar.classList.toggle('show');
        overlay.classList.toggle('show');
        document.body.classList.toggle('sidebar-open');
      });
    }

    // User menu dropdown
    const userMenuToggle = document.getElementById('userMenuToggle');
    const userDropdown = document.getElementById('userDropdown');

    if (userMenuToggle && userDropdown) {
      userMenuToggle.addEventListener('click', function(e) {
        e.stopPropagation();
        userDropdown.classList.toggle('show');
      });

      // Close dropdown when clicking outside
      document.addEventListener('click', function(e) {
        if (!userMenuToggle.contains(e.target) && !userDropdown.contains(e.target)) {
          userDropdown.classList.remove('show');
        }
      });
    }

    // Notification button (placeholder - can be expanded later)
    const notificationBtn = document.getElementById('notificationBtn');
    if (notificationBtn) {
      notificationBtn.addEventListener('click', function() {
        // Redirect to approval queue if there are pending items
        {% if pending_places > 0 %}
          window.location.href = "{% url 'explore:approval_queue' %}";
        {% endif %}
      });
    }

    // Search functionality (placeholder - can be expanded later)
    const searchInput = document.getElementById('topbarSearch');
    if (searchInput) {
      searchInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          // Can implement search functionality here
          console.log('Search:', this.value);
        }
      });
    }
  });
</script>
