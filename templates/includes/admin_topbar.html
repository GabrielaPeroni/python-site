{% load static %}

<div class="admin-topbar">
  <!-- Botão de Menu Mobile -->
  <button class="mobile-menu-btn d-lg-none" id="mobileMenuBtn">
    <i class="bi bi-list"></i>
  </button>

  <!-- Mensagem de Boas-vindas -->
  <div class="topbar-welcome">
    <h1>Bem-vindo, {% if request.user.first_name %}{{ request.user.first_name }}{% else %}{{ request.user.username }}{% endif %}</h1>
  </div>

  <!-- Ações da Barra Superior -->
  <div class="topbar-actions">
    <!-- Caixa de Pesquisa -->
    <div class="search-box d-none d-md-flex">
      <i class="bi bi-search"></i>
      <input type="text" placeholder="Pesquisar" id="topbarSearch">
    </div>

    <!-- Notificações -->
    <div class="notification-btn" id="notificationBtn">
      <i class="bi bi-bell"></i>
      {% if pending_places > 0 %}
        <span class="notification-badge">{{ pending_places }}</span>
      {% endif %}
    </div>

    <!-- Menu do Usuário -->
    <div class="user-menu" id="userMenuToggle">
      {% if request.user.profile_picture %}
        <img src="{{ request.user.profile_picture.url }}" alt="{{ request.user.username }}" class="user-avatar">
      {% else %}
        <div class="user-avatar-placeholder">
          <i class="bi bi-person-circle"></i>
        </div>
      {% endif %}
      <span class="user-name d-none d-md-inline">{{ request.user.username }}</span>
      <i class="bi bi-chevron-down"></i>
    </div>

    <!-- Menu Suspenso do Usuário -->
    <div class="user-dropdown" id="userDropdown">
      <div class="dropdown-header">
        <strong>{{ request.user.username }}</strong>
        <small class="text-muted">{{ request.user.email }}</small>
      </div>
      <div class="dropdown-divider"></div>
      <a href="{% url 'accounts:logout' %}" class="dropdown-item text-danger">
        <i class="bi bi-box-arrow-left me-2"></i>Sair
      </a>
    </div>
  </div>
</div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    // Botão do menu mobile
    const mobileMenuBtn = document.getElementById('mobileMenuBtn');
    const sidebar = document.getElementById('adminSidebar');
    const overlay = document.getElementById('sidebarOverlay');

    if (mobileMenuBtn) {
      mobileMenuBtn.addEventListener('click', function() {
        sidebar.classList.toggle('show');
        overlay.classList.toggle('show');
        document.body.classList.toggle('sidebar-open');
      });
    }

    // Menu suspenso do usuário
    const userMenuToggle = document.getElementById('userMenuToggle');
    const userDropdown = document.getElementById('userDropdown');

    if (userMenuToggle && userDropdown) {
      userMenuToggle.addEventListener('click', function(e) {
        e.stopPropagation();
        userDropdown.classList.toggle('show');
      });

      // Fechar menu suspenso ao clicar fora
      document.addEventListener('click', function(e) {
        if (!userMenuToggle.contains(e.target) && !userDropdown.contains(e.target)) {
          userDropdown.classList.remove('show');
        }
      });
    }

    // Botão de notificações (espaço reservado - pode ser expandido depois)
    const notificationBtn = document.getElementById('notificationBtn');
    if (notificationBtn) {
      notificationBtn.addEventListener('click', function() {
        // Redirecionar para fila de aprovação se houver itens pendentes
        {% if pending_places > 0 %}
          window.location.href = "{% url 'explore:backlog' %}?view=queue";
        {% endif %}
      });
    }

    // Funcionalidade de pesquisa (espaço reservado - pode ser expandido depois)
    const searchInput = document.getElementById('topbarSearch');
    if (searchInput) {
      searchInput.addEventListener('keypress', function(e) {
        if (e.key === 'Enter') {
          // Pode implementar funcionalidade de pesquisa aqui
          console.log('Pesquisar:', this.value);
        }
      });
    }
  });
</script>
