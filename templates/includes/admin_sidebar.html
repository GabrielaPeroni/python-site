{% load static %}

<div class="admin-sidebar" id="adminSidebar">
  <!-- Sidebar Header -->
  <div class="sidebar-header">
    <div class="sidebar-logo">
      <i class="bi bi-grid"></i>
    </div>
    <div class="sidebar-title">
      <h2>DASHBOARD</h2>
      <span class="sidebar-subtitle">Admin Panel</span>
    </div>
  </div>

  <!-- Botão de Colapso Desktop -->
  <button class="sidebar-collapse-btn" id="sidebarCollapseBtn" title="Recolher barra lateral">
    <i class="bi bi-chevron-left"></i>
  </button>

  <!-- Navegação -->
  <nav class="sidebar-nav">
    <a href="{% url 'core:admin_dashboard' %}" class="nav-item {% if request.resolver_match.url_name == 'admin_dashboard' %}active{% endif %}">
      <i class="bi bi-speedometer2"></i>
      <span>Painel</span>
    </a>

    <a href="{% url 'explore:backlog' %}" class="nav-item {% if 'backlog' in request.path or 'approval' in request.path %}active{% endif %}">
      <i class="bi bi-geo-alt"></i>
      <span>Lugares</span>
      {% if pending_places > 0 %}
        <span class="nav-badge">{{ pending_places }}</span>
      {% endif %}
    </a>

    <a href="{% url 'accounts:user_management' %}" class="nav-item {% if 'usuarios' in request.path %}active{% endif %}">
      <i class="bi bi-people"></i>
      <span>Usuários</span>
    </a>

    <a href="{% url 'core:admin_news_list' %}" class="nav-item {% if 'noticias' in request.path %}active{% endif %}">
      <i class="bi bi-newspaper"></i>
      <span>Notícias</span>
      {% if draft_news > 0 %}
        <span class="nav-badge">{{ draft_news }}</span>
      {% endif %}
    </a>
  </nav>

  <!-- Rodapé da Barra Lateral -->
  <div class="sidebar-footer">
    <a href="/admin/" class="nav-item" target="_blank">
      <i class="bi bi-gear-fill"></i>
      <span>Django Admin</span>
    </a>

    <a href="{% url 'core:landing' %}" class="nav-item">
      <i class="bi bi-arrow-left-circle"></i>
      <span>Voltar ao Site</span>
    </a>
  </div>
</div>

<!-- Sobreposição para mobile -->
<div class="sidebar-overlay" id="sidebarOverlay"></div>

<script>
  document.addEventListener('DOMContentLoaded', function() {
    const sidebar = document.getElementById('adminSidebar');
    const overlay = document.getElementById('sidebarOverlay');
    const collapseBtn = document.getElementById('sidebarCollapseBtn');
    const adminContainer = document.querySelector('.admin-container');

    // Restaurar estado da barra lateral do localStorage
    const isCollapsed = localStorage.getItem('sidebarCollapsed') === 'true';
    if (isCollapsed) {
      sidebar.classList.add('collapsed');
      if (adminContainer) {
        adminContainer.classList.add('sidebar-collapsed');
      }
    }

    // Funcionalidade de colapso no desktop
    if (collapseBtn) {
      collapseBtn.addEventListener('click', function() {
        const isCurrentlyCollapsed = sidebar.classList.toggle('collapsed');

        if (adminContainer) {
          adminContainer.classList.toggle('sidebar-collapsed');
        }

        // Atualizar direção do ícone chevron
        const icon = this.querySelector('i');
        if (isCurrentlyCollapsed) {
          icon.classList.remove('bi-chevron-left');
          icon.classList.add('bi-chevron-right');
          this.setAttribute('title', 'Expandir barra lateral');
        } else {
          icon.classList.remove('bi-chevron-right');
          icon.classList.add('bi-chevron-left');
          this.setAttribute('title', 'Recolher barra lateral');
        }

        // Salvar estado no localStorage
        localStorage.setItem('sidebarCollapsed', isCurrentlyCollapsed);
      });

      // Definir estado inicial do ícone
      if (isCollapsed) {
        const icon = collapseBtn.querySelector('i');
        icon.classList.remove('bi-chevron-left');
        icon.classList.add('bi-chevron-right');
        collapseBtn.setAttribute('title', 'Expandir barra lateral');
      }
    }
  });
</script>
